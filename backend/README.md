# ๐ Competency Graph API

API ะดะปั ัะฐะฑะพัั ั ะณัะฐัะพะผ ะบะพะผะฟะตัะตะฝัะธะน ะฝะฐ ะพัะฝะพะฒะต RDF ะพะฝัะพะปะพะณะธะธ ั JWT ะฐะฒัะพัะธะทะฐัะธะตะน.

## ๐ ะัััััะน ััะฐัั

```bash
# ะะฐะฟัััะธัั ะฒัะต ัะตัะฒะธัั
docker-compose down -v
docker-compose build --no-cache
docker-compose up
```

**ะงัะพ ะฟัะพะธััะพะดะธั ะฟัะธ ะทะฐะฟััะบะต:**
1. ๐ ะะฐะฟััะบะฐะตััั GraphDB, PostgreSQL, Redis
2. โ ะัะพะฒะตัััััั healthcheck'ะธ ะฒัะตั ัะตัะฒะธัะพะฒ
3. ๐ง ะะฒัะพะผะฐัะธัะตัะบะธ ัะพะทะดะฐะตััั ัะตะฟะพะทะธัะพัะธะน `competencies` ะฒ GraphDB (ะบะพะฝัะตะนะฝะตั `graphdb-init`)
4. ๐ฏ ะะฐะฟััะบะฐะตััั FastAPI ะฟัะธะปะพะถะตะฝะธะต

ะัะบัะพะนัะต ะฒ ะฑัะฐัะทะตัะต:
- **Swagger UI**: http://localhost/docs
- **GraphDB Workbench**: http://localhost:7200

## ๐ ะะพะบัะผะตะฝัะฐัะธั

- **[QUICKSTART.md](QUICKSTART.md)** - ะะพะดัะพะฑะฝะฐั ะธะฝััััะบัะธั ะฟะพ ะทะฐะฟััะบั ะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธั
- **[AUTH_GUIDE.md](AUTH_GUIDE.md)** - ะัะบะพะฒะพะดััะฒะพ ะฟะพ ะฐะฒัะพัะธะทะฐัะธะธ (ะตัะปะธ ัะฐะนะป ะดะพัััะฟะตะฝ)

## ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   FastAPI App :80       โ
โ   + JWT Auth            โ
โ   + SPARQL Queries      โ
โโโโโโโโโฌโโโโโโโโโโโโโโโโโโ
        โ
    โโโโโดโโโโโฌโโโโโโโโโโโฌโโโโโโโโโโโ
    โผ        โผ          โผ          โผ
โโโโโโโโโโโ โโโโโโโโโ โโโโโโโโ โโโโโโโโโโ
โ GraphDB โ โPostgresโ โRedisโ โVolumesโ
โ  :7200  โ โ :5432  โ โ:6379โ โ       โ
โโโโโโโโโโโ โโโโโโโโโโ โโโโโโโ โโโโโโโโโโ
     โ          โ         โ
  Ontology   Metadata  Sessions
   (RDF)     Comments   Tokens
```

## โจ ะัะฝะพะฒะฝัะต ะฒะพะทะผะพะถะฝะพััะธ

### ๐ ะะฒัะพัะธะทะฐัะธั
- JWT access/refresh ัะพะบะตะฝั
- ะะตะณะธัััะฐัะธั ะธ ะฒัะพะด ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฟัะตะดะตะปะตะฝะธะต ะฐะฒัะพัะฐ ะดะตะนััะฒะธะน
- ะฅัะฐะฝะตะฝะธะต refresh ัะพะบะตะฝะพะฒ ะฒ Redis

### ๐ ะะฐะฑะพัะฐ ั ะณัะฐัะพะผ ะบะพะผะฟะตัะตะฝัะธะน
- ะะพะปััะตะฝะธะต ะฒัะตะณะพ ะณัะฐัะฐ ะธะปะธ ะตะณะพ ัะฐััะธ
- ะะพะธัะบ ะฟัะตะดะบะพะฒ ะธ ะฟะพัะพะผะบะพะฒ ะบะพะผะฟะตัะตะฝัะธะธ
- ะะฐะฒะธะณะฐัะธั ะฟะพ ะพะฝัะพะปะพะณะธะธ ั ัะบะฐะทะฐะฝะธะตะผ ะณะปัะฑะธะฝั
- SPARQL ะทะฐะฟัะพัั ะบ GraphDB

### ๐ฌ ะะพะผะผะตะฝัะธัะพะฒะฐะฝะธะต
- ะะพะผะผะตะฝัะฐัะธะธ ะบ RDF ััะธะฟะปะตัะฐะผ
- ะัะธะฒัะทะบะฐ ะบ ะบะพะฝะบัะตัะฝัะผ ัะฐะนะปะฐะผ ะธ ัััะพะบะฐะผ
- ะะฒัะพะผะฐัะธัะตัะบะฐั ะฐััะธะฑััะธั ะฐะฒัะพัะฐ

## ๐ฏ ะะตะณะธัััะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน

ะัะธ ัะตะณะธัััะฐัะธะธ ะฝะตะพะฑัะพะดะธะผะพ ัะบะฐะทะฐัั:
- Email (ัะฝะธะบะฐะปัะฝัะน)
- ะะฐัะพะปั
- ะะผั (first_name)
- ะคะฐะผะธะปะธั (last_name)

ะัะธะผะตั ัะตะณะธัััะฐัะธะธ ัะตัะตะท API:
```json
{
  "email": "user@example.com",
  "password": "secure_password",
  "first_name": "ะะฒะฐะฝ",
  "last_name": "ะะฒะฐะฝะพะฒ"
}
```

## ๐ง ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ

- **FastAPI** - ะฒะตะฑ-ััะตะนะผะฒะพัะบ
- **GraphDB** - RDF ะฑะฐะทะฐ ะดะฐะฝะฝัั (OntoText)
- **PostgreSQL** - ัะตะปััะธะพะฝะฝะฐั ะะ ะดะปั ะผะตัะฐะดะฐะฝะฝัั
- **Redis** - ะบัั ะดะปั ัะพะบะตะฝะพะฒ
- **SPARQLWrapper** - ัะฐะฑะพัะฐ ั SPARQL
- **JWT** - ะฐะฒัะพัะธะทะฐัะธั
- **Docker Compose** - ะพัะบะตัััะฐัะธั

## ๐ก API Endpoints

### ะะฒัะพัะธะทะฐัะธั
- `POST /api/v1/auth/register` - ะะตะณะธัััะฐัะธั
- `POST /api/v1/auth/login` - ะัะพะด
- `POST /api/v1/auth/refresh` - ะะฑะฝะพะฒะปะตะฝะธะต ัะพะบะตะฝะพะฒ
- `POST /api/v1/auth/logout` - ะััะพะด

### ะัะฐั ะบะพะผะฟะตัะตะฝัะธะน
- `GET /api/v1/competencies/graph` - ะะพะปััะธัั ะฒะตัั ะณัะฐั
- `POST /api/v1/competencies/graph` - ะกะพััะฐะฝะธัั ะณัะฐั
- `GET /api/v1/competencies/graph/{node_id}` - ะะพะปััะธัั ัะฐััั ะณัะฐัะฐ
- `GET /api/v1/competencies/{node_id}/ancestors` - ะัะตะดะบะธ ัะทะปะฐ
- `GET /api/v1/competencies/{node_id}/descendants` - ะะพัะพะผะบะธ ัะทะปะฐ
- `GET /api/v1/competencies/path` - ะััั ะผะตะถะดั ัะทะปะฐะผะธ

### ะะพะผะผะตะฝัะฐัะธะธ
- `POST /api/v1/comments` - ะกะพะทะดะฐัั ะบะพะผะผะตะฝัะฐัะธะธ
- `GET /api/v1/comments/{filename}` - ะะพะปััะธัั ะบะพะผะผะตะฝัะฐัะธะธ

## ๐ ะะตะทะพะฟะฐัะฝะพััั

โ ะะฐัะพะปะธ ัะตัะธัััััั ัะตัะตะท bcrypt
โ JWT ัะพะบะตะฝั ั ะบะพัะพัะบะธะผ ะฒัะตะผะตะฝะตะผ ะถะธะทะฝะธ
โ Refresh ัะพะบะตะฝั ะฒ Redis ั TTL
โ ะะฒัะพะผะฐัะธัะตัะบะฐั ะฟัะพะฒะตัะบะฐ ัะพะบะตะฝะพะฒ ัะตัะตะท middleware
โ CORS ะฝะฐัััะพะตะฝ ะดะปั ะฒัะตั origins (ะธะทะผะตะฝะธัะต ะฒ ะฟัะพะดะฐะบัะตะฝะต!)

## ๐๏ธ ะะฐะทัะฐะฑะพัะบะฐ

### ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
app/
โโโ api/v1/           # API endpoints
โโโ dao/              # Data Access Objects
โโโ db/migrations/    # SQL ะผะธะณัะฐัะธะธ
โโโ dependencies/     # DI ะบะพะฝัะตะนะฝะตัั
โโโ middlewares/      # Middleware (auth)
โโโ models/           # Pydantic ะผะพะดะตะปะธ
โโโ services/         # ะะธะทะฝะตั-ะปะพะณะธะบะฐ
โโโ main.py           # ะขะพัะบะฐ ะฒัะพะดะฐ
```

### ะะพะฑะฐะฒะปะตะฝะธะต ะทะฐะฒะธัะธะผะพััะตะน

ะััะตะดะฐะบัะธััะนัะต `app/pyproject.toml` ะธ ะฟะตัะตัะพะฑะตัะธัะต ะบะพะฝัะตะนะฝะตั:

```bash
docker-compose build --no-cache
```

### ะกะพะทะดะฐะฝะธะต ะผะธะณัะฐัะธะน ะะ

ะะพะฑะฐะฒััะต ะฝะพะฒัะต `.sql` ัะฐะนะปั ะฒ `app/db/migrations/`

## ๐ ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

ะะฐัััะฐะธะฒะฐัััั ะฒ `docker-compose.yaml`:

```yaml
GRAPHDB_URL=http://graphdb:7200
GRAPHDB_REPOSITORY=competencies
DATABASE_URL=postgresql://postgres:postgres@postgres:5432/competency_graph
REDIS_URL=redis://redis:6379/0
JWT_SECRET_KEY=<ะฒะฐั-ัะตะบัะตัะฝัะน-ะบะปัั>
ACCESS_TOKEN_EXPIRE=900      # 15 ะผะธะฝัั
REFRESH_TOKEN_EXPIRE=604800  # 7 ะดะฝะตะน
```

## ๐ Troubleshooting

### ะะ ะฝะต ะพะฑะฝะพะฒะปัะตััั
```bash
docker-compose down -v  # ะฃะดะฐะปะธัั volumes
docker-compose up
```

### ะะพัั 80 ะทะฐะฝัั
ะะทะผะตะฝะธัะต ะฒ `docker-compose.yaml`:
```yaml
ports:
  - "8080:80"  # ะัะฟะพะปัะทัะนัะต ะฟะพัั 8080
```

### Redis ะฝะต ะฟะพะดะบะปััะฐะตััั
```bash
docker ps | grep redis  # ะัะพะฒะตัะธัั ััะฐััั
docker logs competency_graph-redis-1  # ะะพะณะธ
```

## ๐ ะะธัะตะฝะทะธั

MIT

## ๐ฅ ะะพะฝัะฐะบัั

ะะปั ะฒะพะฟัะพัะพะฒ ะธ ะฟัะตะดะปะพะถะตะฝะธะน ัะพะทะดะฐะฒะฐะนัะต issues ะฒ ัะตะฟะพะทะธัะพัะธะธ.
